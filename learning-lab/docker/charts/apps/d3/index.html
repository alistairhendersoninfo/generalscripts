<!DOCTYPE html>
<meta charset="utf-8">
<title>D3 GDP</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.1/dist/tailwind.min.css" />
<body class="bg-slate-950 text-slate-100 min-h-screen">
<div class="max-w-4xl mx-auto py-10">
  <h1 class="text-3xl font-semibold mb-4">GDP per capita (D3.js)</h1>
  <svg id="chart" width="800" height="400"></svg>
</div>
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
<script>
async function render() {
  const res = await fetch('/api/worldbank/gdp_per_capita?country=USA&limit=30');
  const data = await res.json();
  const parseDate = d3.utcParse('%Y-%m-%d');
  const values = data.series.map(d => ({ date: parseDate(d.period), value: +d.value }));
  const svg = d3.select('#chart');
  const width = +svg.attr('width');
  const height = +svg.attr('height');
  const margin = { top: 20, right: 30, bottom: 40, left: 60 };
  const x = d3.scaleUtc()
    .domain(d3.extent(values, d => d.date))
    .range([margin.left, width - margin.right]);
  const y = d3.scaleLinear()
    .domain([0, d3.max(values, d => d.value)]).nice()
    .range([height - margin.bottom, margin.top]);

  const line = d3.line()
    .x(d => x(d.date))
    .y(d => y(d.value));

  svg.append('path')
    .datum(values)
    .attr('fill', 'none')
    .attr('stroke', '#38bdf8')
    .attr('stroke-width', 2)
    .attr('d', line);

  svg.append('g')
    .attr('transform', `translate(0,${height - margin.bottom})`)
    .call(d3.axisBottom(x))
    .selectAll('text').attr('fill', '#cbd5f5');

  svg.append('g')
    .attr('transform', `translate(${margin.left},0)`)
    .call(d3.axisLeft(y))
    .selectAll('text').attr('fill', '#cbd5f5');
}
render();
</script>
</body>
